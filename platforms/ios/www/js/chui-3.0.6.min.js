/*
ChocolateChip-UI
ChUI.js
Copyright 2013 Sourcebits www.sourcebits.com
License: BSD
Version: 3.0.6
*/
!function(a){"use strict";a.extend(a,{eventStart:null,eventEnd:null,eventMove:null,eventCancel:null,gestureLength:30}),window&&window.jQuery&&a===window.jQuery&&a.extend(a,{uuidNum:function(){return Math.floor(4294967296*(1+Math.random()))},make:function(b){return a(b)},concat:function(a){return a instanceof Array?a.join(""):(a=Array.prototype.slice.apply(arguments),String.prototype.concat.apply(a.join("")))},subscriptions:{},subscribe:function(b,c){a.subscriptions[b]||(a.subscriptions[b]=[]);var d=a.uuidNum();return a.subscriptions[b].push({token:d,callback:c}),d},unsubscribe:function(b){setTimeout(function(){for(var c in a.subscriptions)if(a.subscriptions[c])for(var d=0,e=a.subscriptions[c].length;e>d;d++)if(a.subscriptions[c][d].token===b)return a.subscriptions[c].splice(d,1),b;return!1})},publish:function(b,c){return a.subscriptions[b]?(setTimeout(function(){for(var d=a.subscriptions[b]?a.subscriptions[b].length:0;d--;)a.subscriptions[b][d].callback(b,c);return!0}),void 0):!1},templates:{},template:function(a,b){var c,d,e;b=b?b:"data",c=/\[\[=([\s\S]+?)\]\]/g,d="[[",e="]]";var f=new Function(b,"var p=[];p.push('"+a.replace(/[\r\t\n]/g," ").split("'").join("\\'").replace(c,"',$1,'").split(d).join("');").split(e).join("p.push('")+"');return p.join('');");return f},isiPhone:/iphone/gim.test(navigator.userAgent),isiPad:/ipad/gim.test(navigator.userAgent),isiPod:/ipod/gim.test(navigator.userAgent),isiOS:/ip(hone|od|ad)/gim.test(navigator.userAgent),isAndroid:/android/gim.test(navigator.userAgent)&&!/trident/gim.test(navigator.userAgent),isWebOS:/webos/gim.test(navigator.userAgent),isBlackberry:/blackberry/gim.test(navigator.userAgent),isTouchEnabled:"createTouch"in document,isOnline:navigator.onLine,isStandalone:navigator.standalone,isiOS6:navigator.userAgent.match(/OS 6/i),isiOS7:navigator.userAgent.match(/OS 7/i),isWin:/trident/gim.test(navigator.userAgent),isWinPhone:/trident/gim.test(navigator.userAgent)&&/mobile/gim.test(navigator.userAgent),isIE10:navigator.userAgent.match(/msie 10/i),isIE11:navigator.userAgent.match(/msie 11/i),isWebkit:navigator.userAgent.match(/webkit/),isMobile:/mobile/gim.test(navigator.userAgent),isDesktop:!/mobile/gim.test(navigator.userAgent),isSafari:!/Chrome/gim.test(navigator.userAgent)&&/Safari/gim.test(navigator.userAgent),isChrome:/chrome/i.test(navigator.userAgent)}),a.extend(a,{UuidSeed:0,Uuid:function(){var b;return a.UuidSeed++,b=Date.now()+a.UuidSeed,b.toString(36)},array:Array.prototype,UITrackHashNavigation:function(b,c){b=b||!0,a.UISetHashOnUrl(a.UINavigationHistory[a.UINavigationHistory.length-1],c)},UISetHashOnUrl:function(b,c){c=c||"#/";var d;d=/^#/.test(b)?c+b.split("#")[1]:c+b,a.isAndroid?(/#/.test(b)&&(b=b.split("#")[1]),/\//.test(b)&&(b=b.split("/")[1]),window.location.hash="#/"+b):window.history.replaceState("Object","Title",d)},UIGoBackToArticle:function(b){var c,d,e=a.UINavigationHistory.indexOf(b),f=a("article.current"),g=a(b),h=a.UINavigationHistory.splice(e+1);a.publish("chui/navigateBack/leave",f[0].id),a.publish("chui/navigateBack/enter",g[0].id),f[0].scrollTop=0,g[0].scrollTop=0,h.length&&h.forEach(function(b){a(b).removeClass("previous").addClass("next"),a(b).prev().removeClass("previous").addClass("next")}),window&&window.jQuery&&a===window.jQuery?(c=f.next().hasClass("toolbar")?f.next("toolbar"):a(),d=g.next().hasClass("toolbar")?g.next("toolbar"):a()):(c=f.next().hasClass("toolbar"),d=g.next().hasClass("toolbar")),g.removeClass("previous").addClass("current"),g.prev().removeClass("previous").addClass("current"),d.removeClass("previous").addClass("current"),f.removeClass("current").addClass("next"),f.prev().removeClass("current").addClass("next"),c.removeClass("current").addClass("next"),a(".toolbar.previous").removeClass("previous").addClass("next"),a.UISetHashOnUrl(a.UINavigationHistory[a.UINavigationHistory.length-1])},UIGoBack:function(){var b,c,d=a.UINavigationHistory.length,e=a("article.current"),f=a(a.UINavigationHistory[d-2]);a.publish("chui/navigateBack/leave",e[0].id),a.publish("chui/navigateBack/enter",f[0].id),e[0].scrollTop=0,f[0].scrollTop=0,window&&window.jQuery&&a===window.jQuery?(b=e.next().hasClass("toolbar")?e.next(".toolbar"):a(),c=f.next().hasClass("toolbar")?f.next(".toolbar"):a()):(b=e.next().hasClass("toolbar"),c=f.next().hasClass("toolbar")),f.removeClass("previous").addClass("current"),f.prev().removeClass("previous").addClass("current"),c.removeClass("previous").addClass("current"),e.removeClass("current").addClass("next"),e.prev().removeClass("current").addClass("next"),b.removeClass("current").addClass("next"),a.UISetHashOnUrl(a.UINavigationHistory[d-2]),a.UINavigationHistory[d-1]!==a.firstArticle[0].id&&a.UINavigationHistory.pop()},isNavigating:!1,UIGoToArticle:function(b){if(!a.isNavigating){a.isNavigating=!0;var c,d,e=a("article.current"),f=e.prev(),g=b.prev();a.publish("chui/navigate/leave",e[0].id),a.UINavigationHistory.push(b),b=a(b),a.publish("chui/navigate/enter",b[0].id),e[0].scrollTop=0,b[0].scrollTop=0,window&&window.jQuery&&a===window.jQuery?(c=e.next().hasClass("toolbar")?e.next(".toolbar"):a(),d=b.next().hasClass("toolbar")?b.next(".toolbar"):a()):(c=e.next().hasClass("toolbar"),d=b.next().hasClass("toolbar")),e.removeClass("current").addClass("previous"),f.removeClass("current").addClass("previous"),c.removeClass("current").addClass("previous"),b.removeClass("next").addClass("current"),g.removeClass("next").addClass("current"),d.removeClass("next").addClass("current"),a.UISetHashOnUrl(b[0].id),setTimeout(function(){a.isNavigating=!1},500)}},UIDeletable:function(b){if(b&&b.list&&!(!b instanceof Array)){var c,d,e,f=a(b.list),g=b.editLabel||"Edit",h=b.doneLabel||"Done",i=b.deleteLabel||"Delete",j=b.placement||"right",k=b.callback||a.noop;a.isWin&&(i="");var l=function(b){var c;a.isiOS?c="100px":a.isAndroid&&(c="140px"),a(function(){a.body.on("singletap",".edit",function(){var b=this;setTimeout(function(){b.classList.remove("edit"),b.classList.add("done"),a(b).text(h),a(f).addClass("showIndicators")})}),a.body.on("singletap",".done",function(){var b=this;setTimeout(function(){b.classList.remove("done"),b.classList.add("edit"),a(b).text(g),a(f).removeClass("showIndicators"),a(f).find("li").removeClass("selected")})}),a.body.on("singletap",".deletion-indicator",function(){return a(this).closest("li")[0].classList.contains("selected")?(a(this).closest("li").removeClass("selected"),void 0):(a(this).closest("li").addClass("selected"),void 0)}),(a.isiOS||a.isSafari)&&a(f).on("swiperight singletap","li",function(){a(this).removeClass("selected")}),a(f).on("singletap",".delete",function(){var c=this;a(this).siblings().css({"-webkit-transform":"translate3d(-1000%,0,0)","-webkit-transition":"all 1s ease-out"}),setTimeout(function(){b.call(b,c),a(c).parent().remove()},500)})})};if(!f[0].classList.contains("deletable")){var m=a("li").eq(1)[0].clientHeight;return c=a.concat('<a href="javascript:void(null)" class="button delete">',i,"</a>"),d=a.concat('<a href="javascript:void(null)" class="button edit">',g,"</a>"),e='<span class="deletion-indicator"></span>',"left"===j?f.closest("article").prev().prepend(d):(f.closest("article").prev().append(d),f.closest("article").prev().find("h1").addClass("buttonOnRight"),f.closest("article").prev().find(".edit").addClass("align-flush")),f.find("li").prepend(e),f.find("li").append(c),a("li").find(".delete").each(function(b,c){window&&window.jQuery&&a===window.jQuery&&(b=c),(a.isiOS||a.isSafari)&&a(b).css({height:m+"px"})}),l(k),f.addClass("deletable"),f}}},UIPaging:function(){var b=a(".segmented.paging").closest("nav").next(),c=b.children().length;window&&window.jQuery&&a===window.jQuery?a(".segmented.paging").hasClass("horizontal")?b.addClass("horizontal"):a(".segmented.paging").hasClass("vertical")&&b.addClass("vertical"):a(".segmented.paging").hasClass("horizontal")[0]?b.addClass("horizontal"):a(".segmented.paging").hasClass("vertical")[0]&&b.addClass("vertical"),b.children().eq(0).addClass("current"),b.children().eq(0).siblings().addClass("next"),a(".segmented.paging").on(a.eventStart,".button:first-of-type",function(){var b;a(this).next().removeClass("selected"),a(this).addClass("selected"),b=a("section.current"),0!==b.index()&&(b.removeClass("current").addClass("next"),b.prev().removeClass("previous").addClass("current"))}),a(".segmented.paging").on(a.eventStart,".button:last-of-type",function(){var b;a(this).prev().removeClass("selected"),a(this).addClass("selected"),this.classList.contains("disabled")||(b=a("section.current"),b.index()!==c-1&&(b.removeClass("current").addClass("previous"),b.next().removeClass("next").addClass("current")))})},UISlideout:function(b){var c=a.make("<a class='button slide-out-button' href='javascript:void(null)'></a>"),d='<div class="slide-out"><section></section></div>';a("article").removeClass("next"),a("article").removeClass("current"),a("article").prev().removeClass("next"),a("article").prev().removeClass("current"),b=b||"left",a.body.append(d),a.body.addClass("slide-out-app"),a("article:first-of-type").addClass("show"),a("article:first-of-type").prev().addClass("show"),a("#global-nav").append(c),a(".slide-out-button").on(a.eventStart,function(){a(".slide-out").toggleClass("open")}),a(".slide-out").on("singletap","li",function(){var b="#"+a(this).attr("data-show-article");a.UINavigationHistory[0]=b,a.UISetHashOnUrl(b),a.publish("chui/navigate/leave",a("article.show")[0].id),a.publish("chui/navigate/enter",b),a(".slide-out").removeClass("open"),a("article").removeClass("show"),a("article").prev().removeClass("show"),a(b).addClass("show"),a(b).prev().addClass("show")})},UIResetStepper:function(b){var c=a(b).data("ui-value").defaultValue;a(b).find("label").html(c),a(b).find("input")[0].value=c}}),a.fn.extend({UISwitch:function(){var b=!1;this.each(function(c,d){window&&window.jQuery&&a===window.jQuery&&(c=d),c.setAttribute("role","checkbox"),a(c).data("ui-setup")!==!0&&(c.querySelector("input")||c.insertAdjacentHTML("afterBegin",'<input type="checkbox">'),c.classList.contains("on")&&c.querySelector("input").setAttribute("checked","checked"),c.querySelector("em")&&(b=!0),b||c.insertAdjacentHTML("afterBegin","<em></em>"),a(c).on("singletap",function(){var a=c.querySelector("input");c.classList.contains("on")?(c.classList.remove("on"),c.removeAttribute("aria-checked"),a.removeAttribute("checked")):(c.classList.add("on"),a.setAttribute("checked","checked"),c.setAttribute("aria-checked",!0))}),a(c).on("swipeleft",function(){var a=c.querySelector("input");c.classList.contains("on")&&(c.classList.remove("on"),c.removeAttribute("aria-checked"),a.removeAttribute("checked"))}),a(c).on("swiperight",function(){var a=c.querySelector("input");c.classList.contains("on")||(c.classList.add("on"),a.setAttribute("checked","checked"),c.setAttribute("aria-checked",!0))}),a(c).data("ui-setup",!0))})},UISegmented:function(b){if(window&&window.jQuery&&a===window.jQuery){if(this.hasClass("paging"))return}else if(this.hasClass("paging")[0])return;var c,d=b&&b.callback?b.callback:a.noop;b&&b.selected&&(c=b.selected),b&&b.callback&&(d=b.callback),this.find("a").each(function(b,d){window&&window.jQuery&&a===window.jQuery&&(b=d),a(b).find("a").attr("role","radio"),0===c&&0===d&&(b.setAttribute("aria-checked","true"),b.classList.add("selected")),d===c&&(b.setAttribute("aria-checked","true"),b.classList.add("selected"))}),c||this.find(".selected")[0]||this.children().eq(0).addClass("selected"),this.on("singletap",".button",function(b){var c=a(this);this.parentNode.classList.contains("paging")||(c.siblings("a").removeClass("selected"),c.siblings("a").removeAttr("aria-checked"),c.addClass("selected"),c.attr("aria-checked",!0),d.call(this,b))})},UIPanelToggle:function(b,c){var d,e=0;window&&window.jQuery&&a===window.jQuery?a(this).children().hasClass("selected")&&this.children().each(function(b,c){a(c).hasClass("selected")&&(e=b)}):this.children().hasClass("selected")[0]&&(e=this.children().hasClass("selected").index()),b instanceof Array?d=b.children("div"):"string"==typeof b&&(d=a(b).children("div")),d.eq(e).siblings().css({display:"none"}),c&&c.apply(this,arguments),this.on(a.eventEnd,"a",function(){d.eq(a(this).index()).css({display:"block"}).siblings().css("display","none")}),this.on("singletap",".button",function(){var b=a(this);this.parentNode.classList.contains("paging")||(b.siblings("a").removeClass("selected"),b.siblings("a").removeAttr("aria-checked"),b.addClass("selected"),b.attr("aria-checked",!0))})},UISelectList:function(b){var c=b&&b.name?b.name:a.Uuid(),d=this[0];return window&&window.jQuery&&a===window.jQuery?d&&!a(d).hasClass("select")&&this.addClass("select"):d&&!a(d).hasClass("select")[0]&&this.addClass("select"),d?(d.classList.add("select"),a(d).find("li").each(function(d,e){var f;window&&window.jQuery&&a===window.jQuery&&(f=d,d=e,e=f),d.setAttribute("role","radio"),b&&b.selected===e?(d.setAttribute("aria-checked","true"),d.classList.add("selected"),a(d).find("input")[0]?a(d).find("input").attr("checked","checked"):a(d).append('<input type="radio" checked="checked" name="'+c+'">')):a(d).find("input")[0]||a(d).append('<input type="radio" name="'+c+'">')}),a(d).on("singletap","li",function(){var c=this;a(c).siblings("li").removeClass("selected"),a(c).siblings("li").removeAttr("aria-checked"),a(c).siblings("li").find("input").removeAttr("checked"),a(c).addClass("selected"),c.setAttribute("aria-checked",!0),a(c).find("input").attr("checked","checked"),b&&b.callback&&b.callback.apply(this,arguments)}),void 0):[]},UIStepper:function(b){if(!b)return[];if(!b.start)return[];if(!b.end)return[];var c=this[0],d=b.start,e=b.end,f=b.defaultValue?b.defaultValue:b.start,g="+",h="-";a.isWin&&(g="",h="");var i='<a href="javascript:void(null)" class="button decrease">'+h+"</a>",j="<label>"+f+'</label><input type="text" value="'+f+'">',k='<a href="javascript:void(null)" class="button increase">'+g+"</a>";a(c).append(i+j+k),a(c).data("ui-value",{start:d,end:e,defaultValue:f});var l=function(){var b,d=a(c).find("input").val(),e=a(c).data("ui-value"),f=e.start;f>=d?a(this).addClass("disabled"):(b=Number(d)-1,a(c).find(".button:last-of-type").removeClass("disabled"),a(c).find("label").text(b),a(c).find("input")[0].value=b,d===f&&a(this).addClass("disabled"))},m=function(){var b,d=a(c).find("input").val(),e=a(c).data("ui-value"),f=e.end;d>=f?a(this).addClass("disabled"):(b=Number(d)+1,a(c).find(".button:first-of-type").removeClass("disabled"),a(c).find("label").text(b),a(c).find("input")[0].value=b,d===f&&a(this).addClass("disabled"))},n=window&&window.jQuery&&a===jQuery?a(c):[c];n.find(".button:first-of-type").on("singletap",function(){l.call(this,c)}),n.find(".button:last-of-type").on("singletap",function(){m.call(this,c)})},UIBusy:function(b){b=b||{};var c,d=this,e=b.color||"#000",f=b.size||"80px",g=b&&"right"===b.position?"align-flush":null,h=b.duration||"1s",i=function(){var b={"-webkit-animation-duration":h};return c=a.make('<span class="busy"></span>'),a(c).css({"background-color":e,height:f,width:f}),a(c).css(b),a(c).attr("role","progressbar"),g&&a(c).addClass(g),d.append(c),this},j=function(){var b={"-webkit-animation-duration":h};return c=a.make('<div class="busy"><div></div><div></div></div>'),a(c).css({height:f,width:f,"background-image":"url(\"data:image/svg+xml;utf8,<svg xmlns:svg='http://www.w3.org/2000/svg' xmlns='http://www.w3.org/2000/svg' version='1.1' x='0px' y='0px' width='400px' height='400px' viewBox='0 0 400 400' enable-background='new 0 0 400 400' xml:space='preserve'><circle fill='none' stroke='"+e+"' stroke-width='20' stroke-miterlimit='10' cx='199' cy='199' r='174'/></svg>\")"}),a(c).css(b),a(c).attr("role","progressbar"),a(c).innerHTML="<div></div><div></div>",g&&a(c).addClass("align-"+g),d.append(c),this},k=function(){return c=a.make('<progress class="busy"></progress>'),a(c).css({color:e}),a(c).attr("role","progressbar"),a(c).addClass("win-ring"),g&&a(c).addClass("align-"+g),d.append(c),this};a.isiOS||a.isSafari?i(b):a.isWin?k(b):(a.isAndroid||a.isChrome)&&j(b)},UICenter:function(){if(this[0]){var b,c=a(this),d=c.parent();b="absolute"!==c.css("position")?"relative":"absolute";var e,f,g,h;"absolute"===b?(e=c[0].clientHeight,f=c[0].clientWidth,g=d[0].clientHeight,h=d[0].clientWidth):(e=parseInt(c.css("height"),10),f=parseInt(c.css("width"),10),g=parseInt(d.css("height"),10),h=parseInt(d.css("width"),10));var i,j;"body"===d[0].nodeName?(i=window.innerHeight/2+window.pageYOffset-e/2+"px",j=window.innerWidth/2-f/2+"px"):(i=g/2-e/2+"px",j=h/2-f/2+"px"),"absolute"!==b&&(j=0),c.css({left:j,top:i})}},UIBlock:function(b){return b=b?" style='opacity:"+b+"'":" style='opacity: .5;'",a(this).before("<div class='mask'"+b+"></div>"),a("article.current").attr("aria-hidden",!0),this},UIUnblock:function(){return a(".mask").remove(),a("article.current").removeAttr("aria-hidden"),this},UIPopupClose:function(){this[0].classList.contains("popup")&&(a(this).UIUnblock(),a(this).remove())},UIPopover:function(b){if(!b)return[];var c,d=a(this);this[0].id?c=this[0].id:(c=a.Uuid(),d.attr("id",c));var e=b.id?b.id:a.Uuid(),f=b.title?"<header><h1>"+b.title+"</h1></header>":"",g=b.callback?b.callback:a.noop,h='<div class="popover" id="'+e+'">'+f+"<section></section></div>",i=function(b){var c,d,e=a(b).offset(),f=e.left,g=a(".popover"),h=g.offset();c=h.left,d=e.top+a(b)[0].clientHeight,g.width()+e.left>window.innerWidth?g.css({left:window.innerWidth-g.width()-20+"px",top:d+20+"px"}):g.css({left:f+"px",top:d+20+"px"})};a(this).on(a.eventStart,function(){var b=this;a(this).addClass("selected"),setTimeout(function(){a(b).removeClass("selected")},1e3),a.body.append(h),a(".popover").UIBlock(".5");var d="singletap";a.isWin&&a.isDesktop&&(d=a.eventStart+" singletap "+a.eventEnd),a(".mask").on(d,function(a){a.preventDefault(),a.stopPropagation()}),a(".popover").data("triggerEl",c),a.isWin?(i(b),a(".popover").addClass("open")):(a(".popover").addClass("open"),setTimeout(function(){i(b)})),g.call(g,b)})}}),a.extend(a,{UICreateSwitch:function(b){var c=b?b.id:a.Uuid(),d=b&&b.name?' name="'+b.name+'"':"",e=b&&b.value?' value="'+b.value+'"':"",f=b&&"on"===b.state?" "+b.state:"",g=b&&"on"===b.state?' checked="checked"':"",h=a.concat('<span class="switch',f,'" id="',c,'"><em></em>','<input type="checkbox"',d,g,e,"></span>");return a.make(h)},UICreateSegmented:function(a){var b=a&&a.className?a.className:"",c=a&&a.labels?a.labels:[],d=a&&a.selected?a.selected:0,e=['<div class="segmented'];return b&&e.push(" "+b),e.push('">'),c.forEach(function(a,b){e.push('<a role="radio" class="button'),d===b?e.push(' selected" aria-checked="true"'):e.push('"'),e.push(">"),e.push(a),e.push("</a>")}),e.push("</div>"),e.join("")},UIPopup:function(b){if(b){var c,d,e=b.id||a.Uuid(),f=b.title?"<header><h1>"+b.title+"</h1></header>":"",g=b.message?'<p role="note">'+b.message+"</p>":"",h=b.cancelButton?'<a href="javascript:void(null)" class="button cancel" role="button">'+b.cancelButton+"</a>":"",i=b.continueButton?'<a href="javascript:void(null)" class="button continue" role="button">'+b.continueButton+"</a>":"",j=b.callback||a.noop,k=b.empty?' style="padding: 40px 0;" ':"";b.empty?(c="",d=""):(c='<div class="panel">',d="</div>");var l='<div class="popup closed" role="alertdialog" id="'+e+'"'+k+">"+c+f+g+"<footer>"+h+i+"</footer>"+d+"</div>";a.body.append(l),j&&i&&a(".popup").find(".continue").on(a.eventStart,function(){a(".popup").UIPopupClose(),j.call(j)}),a.UICenterPopup(),setTimeout(function(){a.body.find(".popup").removeClass("closed")},200),a.body.find(".popup").UIBlock("0.5");var m=a.eventStart+" singletap "+a.eventEnd;a(".mask").on(m,function(a){a.stopPropagation()})}},UICenterPopup:function(){var b=a(".popup");if(b[0]){var c,d=window.innerHeight/2+window.pageYOffset-b[0].clientHeight/2+"px";c=320===window.innerWidth?"10px":Math.floor((window.innerWidth-318)/2)+"px",a.isWin?b.css({top:d}):b.css({left:c,top:d})}},UIAlignPopover:function(){var b=a(".popover");if(b.length){var c=b.data("triggerEl"),d=a("#"+c).offset(),e=d.left;a(b).width()+d.left>window.innerWidth?b.css({left:window.innerWidth-a(b).width()-20+"px"}):b.css({left:e+"px"})}},UIPopoverClose:function(){a.body.UIUnblock(),a(".popover").css("visibility","hidden"),setTimeout(function(){a(".popover").remove()},10)},UITabbar:function(b){if(b){a.body.addClass("hasTabBar"),a.isiOS6&&a.body.addClass("isiOS6");for(var c=b.id||a.Uuid(),d=b.selected||"",e='<div class="tabbar" id="'+c+'">',f=a.isiOS||a.isSafari?'<span class="icon"></span>':"",g=0;g<b.tabs;g++)e+='<a class="button '+b.icons[g],d===g+1&&(e+=" selected"),e+='">'+f+"<label>"+b.labels[g]+"</label></a>";e+="</div>",a.body.append(e),a("nav").removeClass("current").addClass("next"),a("nav").eq(d).removeClass("next").addClass("current"),a("article").removeClass("current").addClass("next"),a("article").eq(d-1).removeClass("next").addClass("current"),a.body.find(".tabbar").on("singletap",".button",function(){var b,c,d=this;a.publish("chui/navigate/leave",a("article.current")[0].id),d.classList.add("selected"),a(this).siblings("a").removeClass("selected"),b=a(this).index(),a(".previous").removeClass("previous").addClass("next"),a(".current").removeClass("current").addClass("next"),c=a("article").eq(b)[0].id,a.publish("chui/navigate/enter",c),window&&window.jQuery?a("article").each(function(b,c){a(c).scrollTop(0)}):a("article").eq(b).siblings("article").forEach(function(a){a.scrollTop=0}),a.UISetHashOnUrl("#"+c),a.UINavigationHistory[0]==="#"+c?a.UINavigationHistory=[a.UINavigationHistory[0]]:1===a.UINavigationHistory.length?a.UINavigationHistory[0]!=="#"+c&&a.UINavigationHistory.push("#"+c):3===a.UINavigationHistory.length?a.UINavigationHistory.pop():a.UINavigationHistory[1]="#"+c,a("article").eq(b).removeClass("next").addClass("current"),a("nav").eq(b+1).removeClass("next").addClass("current")})}},UISheet:function(b){var c=a.Uuid(),d="",e="";b&&(c=b.id?b.id:c,d=b.listClass?" "+b.listClass:"",e=' style="background-color:'+b.background+';" '||"");var f='<div id="'+c+'" class="sheet'+d+'"><div class="handle"></div><section class="scroller-vertical"></section></div>';a.body.append(f),a(".sheet .handle").on(a.eventStart,function(){a.UIHideSheet()})},UIShowSheet:function(){a("article.current").addClass("blurred"),a.isAndroid||a.isChrome?(a(".sheet").css("display","block"),setTimeout(function(){a(".sheet").addClass("opened")},20)):a(".sheet").addClass("opened")},UIHideSheet:function(){a(".sheet").removeClass("opened"),a("article.current").addClass("removeBlurSlow"),setTimeout(function(){a("article").removeClass("blurred"),a("article").removeClass("removeBlurSlow")},500)},UIDesktopCompat:function(){a.isDesktop&&a.isSafari?a.body.addClass("isiOS").addClass("isDesktopSafari"):a.isDesktop&&a.isChrome&&a.body.addClass("isAndroid").addClass("isDesktopChrome")}}),a.extend(a.UISlideout,{populate:function(b){var c=a(".slide-out");if(c[0]&&a.isArray(b)){c.find("section").append('<ul class="list"></ul>');var d=c.find("ul");b.forEach(function(a){for(var b in a)d.append('<li data-show-article="'+b+'"><h3>'+a[b]+"</h3></li>")})}}}),a(function(){window.navigator.msPointerEnabled?(a.eventStart="MSPointerDown",a.eventEnd="MSPointerUp",a.eventMove="MSPointerMove",a.eventCancel="MSPointerCancel"):"ontouchstart"in window?(a.eventStart="touchstart",a.eventEnd="touchend",a.eventMove="touchmove",a.eventCancel="touchcancel"):(a.eventStart="mousedown",a.eventEnd="click",a.eventMove="mousemove",a.eventCancel="mouseout"),a.body=a("body"),a.firstArticle=a("article").eq(0),/android/gim.test(navigator.userAgent)&&/webkit/gim.test(navigator.userAgent)&&!/Chrome/gim.test(navigator.userAgent)&&document.body.classList.add("isNativeAndroidBrowser"),a("nav").on(a.eventStart,function(a){a.preventDefault()}),a.extend(a,{UINavigationHistory:["#"+a("article").eq(0).attr("id")]}),a("nav").each(function(b,c){var d;window&&window.jQuery&&a===window.jQuery&&(d=b,b=c,c=d),a.body[0].classList.contains("splitlayout")||(0===c?b.classList.add("current"):b.classList.add("next"))}),a("article").each(function(b,c){var d;window&&window.jQuery&&a===window.jQuery&&(d=b,b=c,c=d),a.body[0].classList.contains("splitlayout")||a.body[0].classList.contains("slide-out-app")||(0===c?b.classList.add("current"):b.classList.add("next"))}),a.body[0].classList.contains("splitlayout")||a.body.prepend("<nav id='global-nav'></nav>"),a.body.on("singletap","a.back",function(){this.classList.contains("back")&&a.UIGoBack()}),a.body.on("singletap",".button",function(){var b=a(this);b.parent()[0].classList.contains("tabbar")||(b.addClass("selected"),setTimeout(function(){b.removeClass("selected")},500),this.classList.contains("show-popover")&&(b.addClass("selected"),setTimeout(function(){b.removeClass("selected")},500)))}),a.body.on("singletap doubletap","li",function(){if(!a.isNavigating&&this.hasAttribute("data-goto")&&this.getAttribute("data-goto")&&document.getElementById(this.getAttribute("data-goto"))){var b="#"+this.getAttribute("data-goto");a(b).addClass("navigable");var c=a(b);a.UIGoToArticle(c)}}),a("li[data-goto]").each(function(b,c){window&&window.jQuery&&a===window.jQuery&&(b=c),a(b).closest("article").addClass("navigable");var d="#"+b.getAttribute("data-goto");a(d).addClass("navigable")}),a("article").eq(1)[0]&&a.UISetHashOnUrl(a("article").eq(0)[0].id),a(".segmented").UISegmented(),a(".switch").UISwitch(),a.body.on(a.eventStart,".cancel",function(){a(this).closest(".popup")[0]&&a(this).closest(".popup").UIPopupClose()}),window.onresize=function(){a.UICenterPopup(),a.UIAlignPopover()};var b=a.eventStart+" singletap "+a.eventEnd;a.body.on(b,".mask",function(b){if(a(".popover")[0])a.UIPopoverClose();else{if(b&&1===b.nodeType)return;b.stopPropogation()}}),a.body[0].classList.contains("splitlayout")&&window.innerWidth<768&&a("meta[name=viewport]").attr("content","width=device-width, initial-scale=0.45, maximum-scale=2, user-scalable=yes"),a("h1").each(function(b,c){window&&window.jQuery&&a===window.jQuery&&(b=c),b.nextElementSibling&&"A"===b.nextElementSibling.nodeName&&b.classList.add("buttonOnRight")}),a(".toolbar").prev().addClass("has-toolbar"),a.extend({browserVersion:function(){var a,b=navigator.appName,c=navigator.userAgent,d=c.match(/(opera|chrome|safari|firefox|msie)\/?\s*(\.?\d+(\.\d+)*)/i);return d&&null!==(a=c.match(/version\/([\.\d]+)/i))&&(d[2]=a[1]),d=d?[d[1],d[2]]:[b,navigator.appVersion,"-?"],d[1]}}),a.isWin?a.body.addClass("isWindows"):a.isiOS?a.body.addClass("isiOS"):a.isAndroid&&a.body.addClass("isAndroid"),a.isSafari&&6===parseInt(a.browserVersion(),10)&&a.body.addClass("isSafari6"),a.UIDesktopCompat()})}(this.$),function(a){"use strict";function b(a){return"tagName"in a?a:a.parentNode}function c(a,b,c,d){var e=Math.abs(a-b),f=Math.abs(c-d);return e>=f?a-b>0?"left":"right":c-d>0?"up":"down"}function d(){if(j=null,k.last)try{k&&k.el&&(k.el.trigger("longtap"),k={})}catch(a){}}function e(){j&&clearTimeout(j),j=null}function f(){g&&clearTimeout(g),i&&clearTimeout(i),h&&clearTimeout(h),j&&clearTimeout(j),g=i=h=j=null,k={}}var g,h,i,j,k={},l=750,m=150;a(document).ready(function(){var n,o,p=a(document.body),q=!1;p.on(a.eventStart,function(c){if(n=Date.now(),o=n-(k.last||n),c.originalEvent&&(c=c.originalEvent),window.navigator.msPointerEnabled){if(window&&window.jQuery&&a===window.jQuery){if(c.originalEvent&&!c.originalEvent.isPrimary)return}else if(!c.isPrimary)return;c=c.originalEvent?c.originalEvent:c,p.on("MSHoldVisual",function(a){a.preventDefault()}),k.el=a(b(c.target)),g&&clearTimeout(g),k.x1=c.pageX,k.y1=c.pageY,q=!1}else"mousedown"===a.eventStart?(k.el=a(b(c.target)),g&&clearTimeout(g),k.x1=c.pageX,k.y1=c.pageY,q=!1):2===c.touches.length?console.log("two fingers"):1===c.touches.length&&(k.el=a(b(c.touches[0].target)),g&&clearTimeout(g),k.x1=c.touches[0].pageX,k.y1=c.touches[0].pageY,q=2===c.targetTouches.length?!0:!1);o>0&&250>=o&&(k.isDoubleTap=!0),k.last=n,j=setTimeout(d,l)}),p.on(a.eventMove,function(b){if(b.originalEvent&&(b=b.originalEvent),window.navigator.msPointerEnabled){if(window&&window.jQuery&&a===window.jQuery){if(b.originalEvent&&!b.originalEvent.isPrimary)return}else if(!b.isPrimary)return;b=b.originalEvent?b.originalEvent:b,e(),k.x2=b.pageX,k.y2=b.pageY}else e(),"mousemove"===a.eventMove?(k.x2=b.pageX,k.y2=b.pageY):1===b.touches.length&&(k.x2=b.touches[0].pageX,k.y2=b.touches[0].pageY)}),p.on(a.eventEnd,function(b){if(window.navigator.msPointerEnabled)if(window&&window.jQuery&&a===window.jQuery){if(b.originalEvent&&!b.originalEvent.isPrimary)return}else if(!b.isPrimary)return;e(),k.el&&(k.x2&&Math.abs(k.x1-k.x2)>a.gestureLength||k.y2&&Math.abs(k.y1-k.y2)>a.gestureLength?h=setTimeout(function(){k&&k.el&&(k.el.trigger("swipe"),k.el.trigger("swipe"+c(k.x1,k.x2,k.y1,k.y2)),k={})},0):"last"in k&&(i=setTimeout(function(){k&&k.el&&k.el.trigger("tap"),k&&k.isDoubleTap?k&&k.el&&(k.el.trigger("doubletap"),k={}):g=setTimeout(function(){return g=null,k&&k.el?(k.el.trigger("singletap"),k={},!1):void 0},m)},0)))}),p.on("touchcancel",f),a("body").on("webkitTransitionEnd transitionend","article",function(b){"ARTICLE"===b.target.nodeName&&b.target.classList.contains("current")&&a(b.target).trigger("navigationend")})}),["swipe","swipeleft","swiperight","swipeup","swipedown","doubletap","tap","singletap","longtap"].forEach(function(b){a.fn.extend({method:function(a){return this.on(b,a)}})})}(this.$);